# API Gateway Configuration
# This file contains default configuration values
# Environment variables will override these values (using Viper)

server:
  port: 8000
  mode: "debug" # debug, release, test
  read_timeout: 30s
  write_timeout: 30s

# JWT Configuration for Authentication
jwt:
  secret: "your-secret-key-change-in-production"
  expiration: 24h # Token expiration time
  issuer: "api-gateway"

# Rate Limiting Configuration
rate_limit:
  enabled: true
  requests_per_minute: 100
  burst: 20

# CORS Configuration
cors:
  allowed_origins:
    - "http://localhost:3000"
    - "http://localhost:5173"
    - "http://localhost:4173"
  allowed_methods:
    - "GET"
    - "POST"
    - "PUT"
    - "DELETE"
    - "PATCH"
    - "OPTIONS"
  allowed_headers:
    - "Origin"
    - "Content-Type"
    - "Accept"
    - "Authorization"
    - "X-Requested-With"
    - "Cookie"
    - "Set-Cookie"
  expose_headers:
    - "Set-Cookie"
  allow_credentials: true
  max_age: 12h

# Microservices Configuration
# Define all backend microservices that the gateway will route to
services:
  product_service:
    base_url: "http://localhost:8080" # Use localhost for local development, "http://product-service:8080" for Docker
    timeout: 30s
    health_check_path: "/health"
    routes:
      - path: "/api/v1/products"
        methods: ["GET", "POST"]
        require_auth: false # Public routes
      - path: "/api/v1/products/:id"
        methods: ["GET"]
        require_auth: false # Public routes
      - path: "/api/v1/products/:id"
        methods: ["PUT", "DELETE"]
        require_auth: true # Protected routes
      - path: "/api/v1/products/search"
        methods: ["GET"]
        require_auth: false
      - path: "/api/v1/products/:id/inventory"
        methods: ["PATCH"]
        require_auth: true
      - path: "/api/v1/categories"
        methods: ["GET", "POST"]
        require_auth: false
      - path: "/api/v1/categories/:id"
        methods: ["GET", "PUT", "DELETE"]
        require_auth: false
      - path: "/api/v1/categories/slug/:slug"
        methods: ["GET"]
        require_auth: false
      - path: "/api/v1/categories/:id/children"
        methods: ["GET"]
        require_auth: false
      - path: "/api/v1/categories/:id/products"
        methods: ["GET"]
        require_auth: false

  identity_service:
    base_url: "http://localhost:8081"
    timeout: 30s
    health_check_path: "/health"
    routes:
      - path: "/api/v1/auth/register"
        methods: ["POST"]
        require_auth: false
      - path: "/api/v1/auth/login"
        methods: ["POST"]
        require_auth: false
      - path: "/api/v1/auth/refresh"
        methods: ["POST"]
        require_auth: false
      - path: "/api/v1/auth/logout"
        methods: ["POST"]
        require_auth: true
      - path: "/api/v1/users/profile"
        methods: ["GET", "PUT"]
        require_auth: true
      - path: "/api/v1/users/password"
        methods: ["PUT"]
        require_auth: true
      - path: "/api/v1/addresses"
        methods: ["GET", "POST"]
        require_auth: true
      - path: "/api/v1/addresses/:id"
        methods: ["GET", "PUT", "DELETE"]
        require_auth: true
      - path: "/api/v1/addresses/:id/default"
        methods: ["PUT"]
        require_auth: true
      - path: "/api/v1/shops"
        methods: ["GET", "POST"]
        require_auth: false # GET is public, POST requires auth (handled by middleware)
      - path: "/api/v1/shops/my-shop"
        methods: ["GET"]
        require_auth: true
      - path: "/api/v1/shops/:id"
        methods: ["GET", "PUT", "DELETE"]
        require_auth: false # GET is public, PUT/DELETE require auth
      - path: "/api/v1/shops/:id/status"
        methods: ["PUT"]
        require_auth: true

  search_service:
    base_url: "http://localhost:8002"
    timeout: 30s
    health_check_path: "/health"
    routes:
      - path: "/api/v1/search"
        methods: ["GET"]
        require_auth: false

  order_service:
    base_url: "http://localhost:8083"
    timeout: 30s
    health_check_path: "/health"
    routes:
      - path: "/api/v1/cart"
        methods: ["GET", "DELETE"]
        require_auth: false # Cart can be accessed by guests (session-based)
      - path: "/api/v1/cart/items"
        methods: ["POST"]
        require_auth: false
      - path: "/api/v1/cart/items/:product_id"
        methods: ["PUT", "DELETE"]
        require_auth: false
      - path: "/api/v1/orders"
        methods: ["GET", "POST"]
        require_auth: false # Orders can be created by guests (session-based)
      - path: "/api/v1/orders/:id"
        methods: ["GET"]
        require_auth: false
      - path: "/api/v1/orders/number/:order_number"
        methods: ["GET"]
        require_auth: false

# Logging Configuration
logging:
  level: "info" # debug, info, warn, error
  encoding: "json" # json, console
  output_paths:
    - "stdout"
  error_output_paths:
    - "stderr"
